@startuml
title NextAuth.js OAuth Sign In Flow (Simplified)

actor User
boundary FrontEnd
control "Backend" as AppServer
boundary "OAuth Provider\n(Google/GitHub)" as Provider
database "PostgreSQL" as PostgresDB

== Step 1: User Initiates Login ==
User -> FrontEnd: Click "Sign in"
activate FrontEnd
FrontEnd -> AppServer: Request OAuth login
activate AppServer
AppServer --> FrontEnd: Redirect to OAuth Provider
deactivate AppServer


== Step 2: OAuth Authentication ==
FrontEnd -> Provider: User login request
activate Provider
Provider --> User: Show login & consent form
User -> Provider: Provide credentials\n & approve
Provider --> FrontEnd: Return with authorization code
deactivate Provider


== Step 3: Token Exchange & User Management ==
FrontEnd -> AppServer: Send authorization code
activate AppServer
AppServer -> Provider: Exchange code for user tokens
activate Provider
Provider --> AppServer: Return access tokens \n& user data
deactivate Provider

AppServer -> PostgresDB: Store/update user & create session
activate PostgresDB
PostgresDB --> AppServer: User & session ready
deactivate PostgresDB


== Step 4: Login Complete ==
AppServer --> FrontEnd: Set session & redirect to app
deactivate AppServer
FrontEnd --> User: User successfully logged in
deactivate FrontEnd


@enduml